<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiveGift Pro - 直播互動系統</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- 啟動載入畫面 -->
    <div id="splashScreen" class="splash-screen">
        <div class="splash-content">
            <div class="splash-logo">
                <svg width="64" height="64" viewBox="0 0 32 32" fill="none">
                    <rect width="32" height="32" rx="8" fill="url(#splashGradient)"/>
                    <path d="M10 16L14 20L22 12" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                    <defs>
                        <linearGradient id="splashGradient" x1="0" y1="0" x2="32" y2="32">
                            <stop stop-color="#06b6d4"/>
                            <stop offset="1" stop-color="#8b5cf6"/>
                        </linearGradient>
                    </defs>
                </svg>
            </div>
            <h1 class="splash-title">LiveGift Pro</h1>
            <p class="splash-subtitle">直播互動系統</p>
            <div class="splash-loader"></div>
        </div>
    </div>

    <div class="app">
        <!-- 側邊欄 -->
        <aside class="sidebar">
            <div class="sidebar-brand">
                <div class="brand-logo">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                        <rect width="32" height="32" rx="8" fill="url(#brandGradient)"/>
                        <path d="M10 16L14 20L22 12" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
                        <defs>
                            <linearGradient id="brandGradient" x1="0" y1="0" x2="32" y2="32">
                                <stop stop-color="#06b6d4"/>
                                <stop offset="1" stop-color="#8b5cf6"/>
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <div class="brand-info">
                    <span class="brand-title">LiveGift Pro</span>
                    <span class="brand-subtitle">直播互動系統</span>
                </div>
            </div>

            <div class="sidebar-status" id="statusBadge">
                <span class="status-indicator"></span>
                <span class="status-label">離線中</span>
            </div>

            <nav class="sidebar-menu">
                <div class="menu-label">模組</div>
                <a class="menu-item active" data-panel="wheel">
                    <span class="menu-icon">🎡</span>
                    <span class="menu-text">轉盤/盲盒</span>
                </a>
                <a class="menu-item" data-panel="video">
                    <span class="menu-icon">🎬</span>
                    <span class="menu-text">影片</span>
                    <label class="switch" onclick="event.stopPropagation()">
                        <input type="checkbox" id="videoEnabled" checked>
                        <span class="switch-slider"></span>
                    </label>
                </a>
                <a class="menu-item" data-panel="duckcatch">
                    <span class="menu-icon">🦆</span>
                    <span class="menu-text">抓鴨子</span>
                    <label class="switch" onclick="event.stopPropagation()">
                        <input type="checkbox" id="duckCatchEnabled">
                        <span class="switch-slider"></span>
                    </label>
                </a>
                <a class="menu-item" data-panel="entry">
                    <span class="menu-icon">👋</span>
                    <span class="menu-text">進場特效</span>
                    <label class="switch" onclick="event.stopPropagation()">
                        <input type="checkbox" id="entryEnabled">
                        <span class="switch-slider"></span>
                    </label>
                </a>
                <a class="menu-item" data-panel="chainbattle">
                    <span class="menu-icon">⛓️</span>
                    <span class="menu-text">鎖鏈對抗</span>
                    <label class="switch" onclick="event.stopPropagation()">
                        <input type="checkbox" id="chainBattleEnabled">
                        <span class="switch-slider"></span>
                    </label>
                </a>
                <a class="menu-item" data-panel="giftimage">
                    <span class="menu-icon">🖼️</span>
                    <span class="menu-text">禮物圖生成</span>
                </a>
                <div class="menu-label">系統</div>
                <a class="menu-item" data-panel="logs">
                    <span class="menu-icon">📋</span>
                    <span class="menu-text">日誌</span>
                </a>
                <a class="menu-item" data-panel="settings">
                    <span class="menu-icon">⚙️</span>
                    <span class="menu-text">設定</span>
                </a>
            </nav>

            <div class="sidebar-actions">
                <button class="action-btn action-primary" id="connectBtn" onclick="toggleConnection()">
                    <span class="action-icon">⚡</span>
                    <span>連接 TikTok</span>
                </button>
                <div class="action-row">
                    <button class="action-btn action-secondary" onclick="openGreenScreen('landscape')" title="橫向綠幕">
                        🖥️ 橫向
                    </button>
                    <button class="action-btn action-secondary" onclick="openGreenScreen('portrait')" title="直向綠幕">
                        📱 直向
                    </button>
                </div>
                <button class="action-btn action-ghost" onclick="showSimulateDialog()">
                    🎁 模擬送禮
                </button>
            </div>
            <div class="sidebar-footer">
                <span class="version-info">LiveGift Pro v2.0.0</span>
                <span class="copyright">© 2024 LiveGift</span>
            </div>
        </aside>

        <!-- 主內容區 -->
        <main class="main">
            <!-- 轉盤/盲盒面板 -->
            <section class="panel active" id="panel-wheel">
                <header class="panel-header">
                    <div class="panel-title">
                        <span class="title-icon" style="background: linear-gradient(135deg, #a855f7, #7c3aed);">🎡</span>
                        <div>
                            <h1>轉盤/盲盒模組</h1>
                            <p>收到指定禮物時觸發抽獎</p>
                        </div>
                    </div>
                </header>
                <div class="panel-content">
                    <div class="tabs">
                        <button class="tab active" data-subtab="wheel" onclick="switchWheelSubTab('wheel')">🎡 轉盤</button>
                        <button class="tab" data-subtab="giftbox" onclick="switchWheelSubTab('giftbox')">🎁 盲盒</button>
                    </div>

                    <!-- 轉盤子面板 -->
                    <div class="tab-content active" id="subtab-wheel">
                        <div class="subtab-header">
                            <label class="switch" onclick="event.stopPropagation()">
                                <input type="checkbox" id="wheelEnabled" checked>
                                <span class="switch-slider"></span>
                            </label>
                            <span class="subtab-status" id="wheelStatus">已啟用</span>
                        </div>
                        <div class="grid-2">
                            <div class="card">
                                <div class="card-header">
                                    <h3>觸發禮物</h3>
                                    <button class="btn-add" onclick="showAddWheelGiftDialog()">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                            <path d="M8 2v12M2 8h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div class="list" id="wheelGiftList">
                                        <div class="empty-state">尚無設定</div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h3>轉盤選項</h3>
                                    <button class="btn-add" onclick="showAddWheelOptionDialog()">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                            <path d="M8 2v12M2 8h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div class="list" id="wheelOptionList">
                                        <div class="empty-state">尚無設定</div>
                                    </div>
                                    <div class="hint">
                                        <span class="hint-icon">💡</span>
                                        權重越大，中獎機率越高
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel-footer">
                            <button class="btn btn-outline" onclick="testWheel()">🎯 測試轉盤</button>
                        </div>
                    </div>

                    <!-- 盲盒子面板 -->
                    <div class="tab-content" id="subtab-giftbox">
                        <div class="subtab-header">
                            <label class="switch" onclick="event.stopPropagation()">
                                <input type="checkbox" id="giftboxEnabled">
                                <span class="switch-slider"></span>
                            </label>
                            <span class="subtab-status" id="giftboxStatus">已停用</span>
                        </div>
                        <div class="grid-2">
                            <div class="card">
                                <div class="card-header">
                                    <h3>觸發禮物</h3>
                                    <button class="btn-add" onclick="showAddGiftboxGiftDialog()">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                            <path d="M8 2v12M2 8h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div class="list" id="giftboxGiftList">
                                        <div class="empty-state">尚無設定</div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h3>盲盒選項</h3>
                                    <button class="btn-add" onclick="showAddGiftboxOptionDialog()">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                            <path d="M8 2v12M2 8h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div class="list" id="giftboxOptionList">
                                        <div class="empty-state">尚無設定</div>
                                    </div>
                                    <div class="hint">
                                        <span class="hint-icon">💡</span>
                                        權重越大，中獎機率越高
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="panel-footer">
                            <button class="btn btn-outline" onclick="testGiftbox()">🎁 測試盲盒</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 影片面板 -->
            <section class="panel" id="panel-video">
                <header class="panel-header">
                    <div class="panel-title">
                        <span class="title-icon" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);">🎬</span>
                        <div>
                            <h1>影片模組</h1>
                            <p>收到禮物/彈幕/點讚時播放影片</p>
                        </div>
                    </div>
                </header>
                <div class="panel-content">
                    <div class="tabs">
                        <button class="tab active" data-subtab="fixed" onclick="switchVideoSubTab('fixed')">🎬 固定影片</button>
                        <button class="tab" data-subtab="random" onclick="switchVideoSubTab('random')">🎲 隨機影片</button>
                    </div>

                    <div class="tab-content active" id="subtab-fixed">
                        <!-- 場景選擇器 -->
                        <div class="scene-selector card">
                            <div class="card-header">
                                <h3>🎬 場景</h3>
                                <div class="scene-actions">
                                    <button class="btn btn-sm" onclick="createNewScene()" title="新增場景">+ 新增</button>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="scene-list" id="sceneList">
                                    <!-- 場景列表會由 JS 動態生成 -->
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h3>觸發設定 <span class="scene-name-badge" id="currentSceneBadge"></span></h3>
                                <button class="btn-add" onclick="showAddVideoGiftDialog()">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                        <path d="M8 2v12M2 8h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="card-content">
                                <div class="list list-tall" id="videoGiftList">
                                    <div class="empty-state">尚無設定</div>
                                </div>
                            </div>
                        </div>
                        <div class="panel-footer">
                            <button class="btn btn-outline" onclick="testVideo()">▶️ 測試影片</button>
                        </div>
                    </div>

                    <div class="tab-content" id="subtab-random">
                        <div class="card">
                            <div class="card-header">
                                <h3>觸發設定</h3>
                                <button class="btn-add" onclick="showAddRandomVideoDialog()">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                        <path d="M8 2v12M2 8h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="card-content">
                                <div class="list list-tall" id="randomVideoList">
                                    <div class="empty-state">尚無設定</div>
                                </div>
                            </div>
                        </div>
                        <div class="panel-footer">
                            <button class="btn btn-outline" onclick="testRandomVideo()">▶️ 測試隨機影片</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 抓鴨子面板 -->
            <section class="panel" id="panel-duckcatch">
                <header class="panel-header">
                    <div class="panel-title">
                        <span class="title-icon" style="background: linear-gradient(135deg, #fbbf24, #f59e0b);">🦆</span>
                        <div>
                            <h1>抓鴨子模組</h1>
                            <p>隨機抓到或沒抓到鴨子，並統計數量</p>
                        </div>
                    </div>
                </header>
                <div class="panel-content">
                    <div class="duck-stats">
                        <div class="duck-count-box">
                            <span class="duck-icon">🦆</span>
                            <span class="duck-number" id="duckCountDisplay">0</span>
                            <span class="duck-label">隻鴨子</span>
                        </div>
                        <div class="duck-buttons">
                            <button class="btn btn-sm" onclick="adjustDuckCount(-1)">-1</button>
                            <button class="btn btn-sm" onclick="adjustDuckCount(-5)">-5</button>
                            <button class="btn btn-sm" onclick="adjustDuckCount(1)">+1</button>
                            <button class="btn btn-sm" onclick="adjustDuckCount(5)">+5</button>
                            <button class="btn btn-sm btn-primary" onclick="openAddDuckDialog()">補鴨子</button>
                            <button class="btn btn-sm btn-danger" onclick="resetDuckCount()">歸零</button>
                        </div>
                        <div class="shortcut-info">快捷鍵: F9 減1 / F10 減5 / F11 歸零</div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>觸發設定</h3>
                        </div>
                        <div class="card-content">
                            <div class="form-grid">
                                <div class="form-group half">
                                    <label>觸發方式</label>
                                    <select id="duckTriggerType" class="input" onchange="toggleDuckTriggerOptions()">
                                        <option value="gift">禮物</option>
                                        <option value="chat">彈幕關鍵字</option>
                                        <option value="like">點讚</option>
                                    </select>
                                </div>
                                <div class="form-group half" id="duckGiftGroup">
                                    <label>觸發禮物名稱</label>
                                    <input type="text" id="duckTriggerGift" class="input" placeholder="例如: Rose">
                                </div>
                                <div class="form-group half" id="duckKeywordGroup" style="display:none">
                                    <label>彈幕關鍵字</label>
                                    <input type="text" id="duckTriggerKeyword" class="input" placeholder="觸發的關鍵字">
                                </div>
                                <div class="form-group full">
                                    <label>抓到機率</label>
                                    <div class="range-input">
                                        <input type="range" id="duckCatchRate" value="50" min="0" max="100"
                                               oninput="document.getElementById('duckCatchRateValue').textContent = this.value + '%'">
                                        <span id="duckCatchRateValue" class="range-value">50%</span>
                                    </div>
                                </div>
                                <div class="form-group half">
                                    <label>播放秒數 (0=完整)</label>
                                    <input type="number" id="duckVideoSeconds" class="input" value="0" min="0" step="0.5">
                                </div>
                                <div class="form-group half">
                                    <label>播放倍率</label>
                                    <input type="number" id="duckVideoSpeed" class="input" value="1.0" min="0.1" max="4" step="0.1">
                                </div>
                                <div class="form-group full">
                                    <label>音量</label>
                                    <div class="range-input">
                                        <input type="range" id="duckVideoVolume" value="100" min="0" max="100"
                                               oninput="document.getElementById('duckVolumeValue').textContent = this.value + '%'">
                                        <span id="duckVolumeValue" class="range-value">100%</span>
                                    </div>
                                </div>
                                <div class="form-group full">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="duckForceInterrupt">
                                        <span class="checkbox-box"></span>
                                        強制插隊 (中斷當前播放)
                                    </label>
                                </div>
                                <div class="form-group full">
                                    <label>🔊 嘎嘎音效（減少鴨子時播放）</label>
                                    <div class="input-with-button">
                                        <input type="text" id="duckQuackSound" class="input" placeholder="選擇音效檔案（可選）" readonly>
                                        <button class="btn btn-outline" onclick="selectDuckQuackSound()">選擇</button>
                                        <button class="btn btn-outline" onclick="clearDuckQuackSound()">清除</button>
                                    </div>
                                </div>
                                <!-- 保底設定 -->
                                <div class="form-group full" style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(255,255,255,0.1);">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="duckPityEnabled">
                                        <span class="checkbox-box"></span>
                                        🎯 啟用保底機制
                                    </label>
                                </div>
                                <div class="form-group half">
                                    <label>🎉 第一層保底次數</label>
                                    <input type="number" id="duckPityThreshold" class="input" value="1000" min="100" max="10000">
                                </div>
                                <div class="form-group half">
                                    <label>第一層最低鴨子數</label>
                                    <input type="number" id="duckPityMinAmount" class="input" value="5000" min="100">
                                </div>
                                <div class="form-group half">
                                    <label>🏆 終極保底次數</label>
                                    <input type="number" id="duckPityThresholdJackpot" class="input" value="2000" min="200" max="20000">
                                </div>
                                <div class="form-group half">
                                    <label>終極保底鴨子數</label>
                                    <input type="number" id="duckPityJackpotAmount" class="input" value="10000" min="1000">
                                </div>
                                <div class="form-group full">
                                    <div class="pity-display" id="pityDisplay" style="display: none;">
                                        <span>保底進度：</span>
                                        <span id="pityProgress" class="editable" onclick="showPityInput()" title="點擊輸入數字">0 / 1000</span>
                                        <input type="number" class="pity-input hidden" id="pityInput" min="0" onblur="savePityInput()" onkeydown="if(event.key==='Enter')savePityInput()">
                                        <span id="pityStage" style="margin-left: 8px; font-size: 12px; color: var(--text-muted);"></span>
                                        <button class="btn btn-sm btn-outline" onclick="resetPityCounter()">重置</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid-2">
                        <div class="card">
                            <div class="card-header">
                                <h3>🎉 抓到影片</h3>
                                <div class="header-buttons">
                                    <button class="btn btn-sm btn-primary" onclick="smartImportDuckVideos('caught')">🪄 智能匯入</button>
                                    <button class="btn-add" onclick="showAddDuckVideoDialog('caught')" title="單個添加">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                            <path d="M8 2v12M2 8h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="list" id="duckCaughtVideoList">
                                    <div class="empty-state">尚無設定</div>
                                </div>
                                <div class="hint">
                                    <span class="hint-icon">💡</span>
                                    智能匯入會從檔名解析鴨子數量並自動設定權重
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3>😢 沒抓到影片</h3>
                                <div class="header-buttons">
                                    <button class="btn btn-sm btn-primary" onclick="smartImportDuckVideos('missed')">🪄 智能匯入</button>
                                    <button class="btn-add" onclick="showAddDuckVideoDialog('missed')" title="單個添加">
                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                            <path d="M8 2v12M2 8h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="card-content">
                                <div class="list" id="duckMissedVideoList">
                                    <div class="empty-state">尚無設定</div>
                                </div>
                                <div class="hint">
                                    <span class="hint-icon">💡</span>
                                    沒抓到影片權重統一設為 1（隨機播放）
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 排行榜 -->
                    <div class="card">
                        <div class="card-header">
                            <h3>🏆 排行榜</h3>
                            <div class="header-buttons">
                                <button class="btn btn-sm btn-outline" onclick="refreshLeaderboard()">🔄 刷新</button>
                                <button class="btn btn-sm btn-danger" onclick="clearLeaderboard()">🗑️ 清除</button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="leaderboard-info" style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">
                                累計排行每週日 00:00 重置 | 單次最高每天 00:00 重置
                            </div>
                            <div class="leaderboard-tabs">
                                <button class="leaderboard-tab active" data-tab="total" onclick="switchLeaderboardTab('total')">📊 累計排行</button>
                                <button class="leaderboard-tab" data-tab="single" onclick="switchLeaderboardTab('single')">🎯 單次最高</button>
                                <button class="leaderboard-tab" data-tab="alltime" onclick="switchLeaderboardTab('alltime')">📚 總體資料庫</button>
                            </div>
                            <div class="leaderboard-content" id="leaderboardTotal">
                                <div class="leaderboard-list" id="totalRankingList">
                                    <div class="empty-state">暫無資料</div>
                                </div>
                            </div>
                            <div class="leaderboard-content hidden" id="leaderboardSingle">
                                <div class="leaderboard-list" id="singleHighestList">
                                    <div class="empty-state">暫無資料</div>
                                </div>
                            </div>
                            <div class="leaderboard-content hidden" id="leaderboardAlltime">
                                <div class="alltime-controls" style="margin-bottom: 10px; display: flex; gap: 8px;">
                                    <input type="text" id="alltimeSearch" class="input" placeholder="搜尋用戶..." style="flex:1" oninput="filterAlltimeStats()">
                                    <button class="btn btn-sm btn-primary" onclick="openAddUserDialog()">➕ 新增用戶</button>
                                </div>
                                <div class="leaderboard-list" id="alltimeStatsList">
                                    <div class="empty-state">暫無資料</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 里程碑慶祝設定 -->
                    <div class="card">
                        <div class="card-header">
                            <h3>🎆 里程碑慶祝</h3>
                        </div>
                        <div class="card-content">
                            <div class="milestone-info">
                                <div class="info-item">
                                    <span class="info-label">🏆 累計第一</span>
                                    <span class="info-value">達到 10,000🦆 且成為第一名時播放</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">🎯 單次最高</span>
                                    <span class="info-value">單次抓到 5,000+🦆 創紀錄時播放（保底不計）</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>煙火影片</label>
                                <div class="input-with-button">
                                    <input type="text" id="milestoneFireworkVideo" placeholder="選擇煙火影片..." readonly>
                                    <button class="btn btn-outline" onclick="selectMilestoneVideo()">選擇</button>
                                </div>
                            </div>
                            <button class="btn btn-outline btn-sm" onclick="testMilestoneCelebration()">🎇 測試慶祝效果</button>
                        </div>
                    </div>

                    <div class="panel-footer">
                        <button class="btn btn-primary" onclick="saveDuckCatchConfig()">💾 儲存設定</button>
                        <button class="btn btn-outline" onclick="openSimulateDuckDialog()">🎲 模擬抓鴨子</button>
                    </div>
                </div>
            </section>

            <!-- 進場面板 -->
            <section class="panel" id="panel-entry">
                <header class="panel-header">
                    <div class="panel-title">
                        <span class="title-icon" style="background: linear-gradient(135deg, #ec4899, #db2777);">👋</span>
                        <div>
                            <h1>進場特效</h1>
                            <p>有人進入直播間時播放影片或音效</p>
                        </div>
                    </div>
                </header>
                <div class="panel-content">
                    <div class="grid-2">
                        <div class="card">
                            <div class="card-header">
                                <h3>進場用戶列表</h3>
                                <button class="btn-add" onclick="showAddEntryDialog()">
                                    <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                        <path d="M8 2v12M2 8h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="card-content">
                                <div class="list" id="entryList">
                                    <div class="empty-state">尚未設定進場用戶</div>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3>🔍 高等級用戶 (Lv20+)</h3>
                                <span class="badge" id="highLevelUserCount">0 人</span>
                            </div>
                            <div class="card-content">
                                <div class="search-controls">
                                    <div class="search-row">
                                        <select id="accountSelector" class="input" onchange="onAccountChange()">
                                            <option value="">-- 選擇帳號 --</option>
                                        </select>
                                        <button class="btn btn-sm" onclick="refreshAccountList()">🔄</button>
                                    </div>
                                    <div class="search-row">
                                        <input type="text" id="userSearchInput" class="input" placeholder="搜尋名稱..." onkeyup="if(event.key==='Enter') searchUsers()">
                                        <button class="btn btn-sm btn-primary" onclick="searchUsers()">搜尋</button>
                                        <button class="btn btn-sm" onclick="searchUsers('')">全部</button>
                                        <button class="btn btn-sm btn-danger" onclick="clearHighLevelUsers()">清空</button>
                                    </div>
                                </div>
                                <div class="search-results" id="userSearchResults">
                                    <div class="empty-state">連接後，高等級用戶會自動記錄</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel-footer">
                        <button class="btn btn-outline" onclick="testEntryEffect()">▶️ 測試效果</button>
                    </div>
                </div>
            </section>

            <!-- 鎖鏈對抗面板 -->
            <section class="panel" id="panel-chainbattle">
                <header class="panel-header">
                    <div class="panel-title">
                        <span class="title-icon" style="background: linear-gradient(135deg, #6b7280, #374151);">⛓️</span>
                        <div>
                            <h1>鎖鏈對抗</h1>
                            <p>觀眾送禮鎖住畫面，主播按空白鍵掙脫</p>
                        </div>
                    </div>
                </header>
                <div class="panel-content">
                    <!-- 啟動禮物 -->
                    <div class="card">
                        <div class="card-header">
                            <h3>🔓 啟動禮物</h3>
                        </div>
                        <div class="card-content">
                            <div class="form-grid">
                                <div class="form-group half">
                                    <label>禮物名稱（英文）</label>
                                    <input type="text" id="chainTriggerGift" class="input" placeholder="例如 Rose" onchange="saveChainBattleConfig()">
                                </div>
                                <div class="form-group half">
                                    <label>初始鎖鏈數</label>
                                    <input type="number" id="chainTriggerAmount" class="input" value="10" min="1" onchange="saveChainBattleConfig()">
                                </div>
                            </div>
                            <p style="color: #9ca3af; font-size: 12px; margin-top: 8px;">
                                💡 只有這個禮物可以啟動鎖鏈對抗
                            </p>
                        </div>
                    </div>

                    <!-- 增加禮物 -->
                    <div class="card" style="margin-top: 16px;">
                        <div class="card-header">
                            <h3>➕ 增加禮物</h3>
                        </div>
                        <div class="card-content">
                            <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                                <input type="text" id="chainAddGiftName" class="input" placeholder="禮物名稱（英文）" style="flex: 1;">
                                <input type="number" id="chainAddGiftAmount" class="input" placeholder="增加數" value="1" min="1" style="width: 80px;">
                                <button class="btn btn-primary" onclick="addChainAddGift()">新增</button>
                            </div>
                            <div id="chainAddGiftList" class="gift-list">
                                <!-- 動態生成 -->
                            </div>
                            <p style="color: #9ca3af; font-size: 12px; margin-top: 8px;">
                                💡 對抗進行中，送這些禮物會增加鎖鏈數
                            </p>
                        </div>
                    </div>

                    <!-- 手動控制 -->
                    <div class="card" style="margin-top: 16px;">
                        <div class="card-header">
                            <h3>手動控制</h3>
                        </div>
                        <div class="card-content">
                            <div class="button-group">
                                <button class="btn btn-primary" onclick="startChainBattleManual()">⛓️ 啟動對抗</button>
                                <button class="btn btn-danger" onclick="stopChainBattleManual()">🛑 停止對抗</button>
                            </div>
                            <p style="color: #9ca3af; font-size: 12px; margin-top: 12px;">
                                💡 主播按 <kbd style="background: #374151; padding: 2px 6px; border-radius: 4px;">空白鍵</kbd> 減少鎖鏈數
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 禮物圖生成面板 -->
            <section class="panel" id="panel-giftimage">
                <header class="panel-header">
                    <div class="panel-title">
                        <span class="title-icon" style="background: linear-gradient(135deg, #f472b6, #ec4899);">🖼️</span>
                        <div>
                            <h1>禮物圖生成器</h1>
                            <p>生成禮物清單圖片，可用於 OBS 或匯出分享</p>
                        </div>
                    </div>
                </header>
                <div class="panel-content">
                    <div class="two-column-layout">
                        <!-- 左側：禮物清單 -->
                        <div class="column">
                            <div class="card">
                                <div class="card-header">
                                    <h3>禮物清單</h3>
                                    <button class="btn btn-sm btn-primary" onclick="addGiftImageItem()">+ 新增</button>
                                </div>
                                <div class="card-content">
                                    <div class="gift-image-list" id="giftImageList">
                                        <div class="empty-list">尚未新增禮物，點擊上方「新增」按鈕開始</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- 右側：樣式設定 -->
                        <div class="column">
                            <div class="card">
                                <div class="card-header">
                                    <h3>排列設定</h3>
                                </div>
                                <div class="card-content">
                                    <div class="form-grid">
                                        <div class="form-group half">
                                            <label>欄數</label>
                                            <select id="giftImageColumns" class="input" onchange="updateGiftImagePreview()">
                                                <option value="1">1 欄（直式）</option>
                                                <option value="2">2 欄</option>
                                                <option value="3" selected>3 欄</option>
                                                <option value="4">4 欄</option>
                                                <option value="5">5 欄</option>
                                                <option value="6">6 欄</option>
                                            </select>
                                        </div>
                                        <div class="form-group half">
                                            <label>圖示位置</label>
                                            <select id="giftImageIconPosition" class="input" onchange="updateGiftImagePreview()">
                                                <option value="left" selected>左邊</option>
                                                <option value="right">右邊</option>
                                            </select>
                                        </div>
                                        <div class="form-group half">
                                            <label>間距 (px)</label>
                                            <input type="number" id="giftImageGap" class="input" value="20" min="0" max="100" onchange="updateGiftImagePreview()">
                                        </div>
                                        <div class="form-group half">
                                            <label>圖示大小 (px)</label>
                                            <input type="number" id="giftImageIconSize" class="input" value="64" min="32" max="128" onchange="updateGiftImagePreview()">
                                        </div>
                                        <div class="form-group half">
                                            <label>內邊距 (px)</label>
                                            <input type="number" id="giftImagePadding" class="input" value="30" min="0" max="100" onchange="updateGiftImagePreview()">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h3>背景設定</h3>
                                </div>
                                <div class="card-content">
                                    <div class="form-grid">
                                        <div class="form-group half">
                                            <label>背景類型</label>
                                            <select id="giftImageBgType" class="input" onchange="toggleGiftImageBgOptions(); updateGiftImagePreview()">
                                                <option value="solid">純色</option>
                                                <option value="transparent">透明</option>
                                                <option value="gradient">漸層</option>
                                            </select>
                                        </div>
                                        <div class="form-group half" id="giftImageBgColorGroup">
                                            <label>背景顏色</label>
                                            <input type="color" id="giftImageBgColor" class="input color-input" value="#1a1a2e" onchange="updateGiftImagePreview()">
                                        </div>
                                        <div class="form-group half" id="giftImageBgColor2Group" style="display:none">
                                            <label>漸層顏色 2</label>
                                            <input type="color" id="giftImageBgColor2" class="input color-input" value="#16213e" onchange="updateGiftImagePreview()">
                                        </div>
                                        <div class="form-group full">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="giftImageRounded" checked onchange="updateGiftImagePreview()">
                                                <span class="checkbox-box"></span>
                                                圓角背景
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h3>文字設定</h3>
                                </div>
                                <div class="card-content">
                                    <div class="form-grid">
                                        <div class="form-group half">
                                            <label>字體大小 (px)</label>
                                            <input type="number" id="giftImageFontSize" class="input" value="24" min="12" max="48" onchange="updateGiftImagePreview()">
                                        </div>
                                        <div class="form-group half">
                                            <label>文字顏色</label>
                                            <input type="color" id="giftImageFontColor" class="input color-input" value="#ffffff" onchange="updateGiftImagePreview()">
                                        </div>
                                        <div class="form-group full">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="giftImageFontBold" checked onchange="updateGiftImagePreview()">
                                                <span class="checkbox-box"></span>
                                                粗體
                                            </label>
                                        </div>
                                        <div class="form-group full">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="giftImageTextShadow" checked onchange="updateGiftImagePreview()">
                                                <span class="checkbox-box"></span>
                                                文字陰影
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 預覽區域 -->
                    <div class="card" style="margin-top: 20px;">
                        <div class="card-header">
                            <h3>預覽</h3>
                            <div class="header-actions">
                                <button class="btn btn-sm btn-outline" onclick="updateGiftImagePreview()">🔄 重新整理</button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="gift-image-preview-container" id="giftImagePreviewContainer">
                                <div class="gift-image-preview" id="giftImagePreview">
                                    <div class="preview-placeholder">新增禮物後即可預覽</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="panel-footer">
                        <button class="btn btn-outline" id="btnSendGiftImage" onclick="toggleGiftImageOnGreenScreen()">📺 發送到綠幕</button>
                        <button class="btn btn-secondary" id="btnRefreshGiftImage" onclick="refreshGiftImageOnGreenScreen()" style="display: none;">🔄 重新整理</button>
                        <button class="btn btn-primary" onclick="exportGiftImage()">💾 匯出圖片</button>
                    </div>
                </div>
            </section>

            <!-- 日誌面板 -->
            <section class="panel" id="panel-logs">
                <header class="panel-header">
                    <div class="panel-title">
                        <span class="title-icon" style="background: linear-gradient(135deg, #06b6d4, #0891b2);">📋</span>
                        <div>
                            <h1>即時日誌</h1>
                            <p>查看系統運行狀態和事件記錄</p>
                        </div>
                    </div>
                </header>
                <div class="panel-content">
                    <div class="log-filters">
                        <label class="filter-chip"><input type="checkbox" id="filterChat" checked><span>💬 聊天</span></label>
                        <label class="filter-chip"><input type="checkbox" id="filterGift" checked><span>🎁 禮物</span></label>
                        <label class="filter-chip"><input type="checkbox" id="filterLike" checked><span>❤️ 點讚</span></label>
                        <label class="filter-chip"><input type="checkbox" id="filterEntry" checked><span>👋 進場</span></label>
                        <label class="filter-chip"><input type="checkbox" id="filterFollow" checked><span>➕ 關注</span></label>
                        <label class="filter-chip"><input type="checkbox" id="filterOther" checked><span>📝 其他</span></label>
                    </div>
                    <div class="log-container">
                        <div class="log-content" id="logContent">
                            <div class="log-item">系統已就緒，等待連接...</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 設定面板 -->
            <section class="panel" id="panel-settings">
                <header class="panel-header">
                    <div class="panel-title">
                        <span class="title-icon" style="background: linear-gradient(135deg, #64748b, #475569);">⚙️</span>
                        <div>
                            <h1>系統設定</h1>
                            <p>配置連接和顯示選項</p>
                        </div>
                    </div>
                </header>
                <div class="panel-content">
                    <div class="settings-list">
                        <div class="card">
                            <div class="card-header"><h3>🔗 連接設定</h3></div>
                            <div class="card-content">
                                <div class="form-group">
                                    <label>TikTok 用戶名</label>
                                    <input type="text" id="tiktokUsernameInput" class="input" placeholder="例如: example_user">
                                    <small>輸入要監控的直播間用戶名（@ 後面的 ID）</small>
                                </div>
                                <div class="form-group">
                                    <label>Eulerstream API Key</label>
                                    <input type="password" id="apiKeyInput" class="input" placeholder="euler_xxxxxxxx...">
                                    <small>從 <a href="https://www.eulerstream.com" target="_blank">eulerstream.com</a> 取得</small>
                                </div>
                                <div class="form-group">
                                    <label>WebSocket 埠號</label>
                                    <input type="number" id="portInput" class="input input-sm" value="10010">
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header"><h3>🖥️ 顯示設定</h3></div>
                            <div class="card-content">
                                <div class="form-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="autoOpenGreenScreen">
                                        <span class="checkbox-box"></span>
                                        連接時自動開啟綠幕視窗
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header"><h3>🌐 語言設定</h3></div>
                            <div class="card-content">
                                <div class="form-group">
                                    <label>介面語言</label>
                                    <select id="languageSelect" class="input" onchange="changeLanguage(this.value)">
                                        <option value="zh-TW">繁體中文</option>
                                        <option value="zh-CN">简体中文</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel-footer">
                        <button class="btn btn-primary" onclick="saveSettings()">💾 儲存設定</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- 對話框遮罩 -->
    <div class="modal-overlay" id="dialogOverlay" onclick="closeAllDialogs()"></div>

    <!-- 轉盤禮物對話框 -->
    <div class="modal" id="wheelGiftDialog">
        <div class="modal-header">
            <h3 id="wheelGiftDialogTitle">新增轉盤觸發</h3>
            <button class="modal-close" onclick="closeDialog('wheelGiftDialog')">×</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="wheelGiftEditIndex" value="-1">
            <div class="form-group">
                <label>禮物名稱</label>
                <input type="text" id="wheelGiftName" class="input" placeholder="例如: Rose">
            </div>
            <div class="form-group">
                <label>轉盤次數 (每個禮物)</label>
                <input type="number" id="wheelGiftSpins" class="input input-sm" value="1" min="1">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeDialog('wheelGiftDialog')">取消</button>
            <button class="btn btn-primary" onclick="saveWheelGift()">儲存</button>
        </div>
    </div>

    <!-- 轉盤選項對話框 -->
    <div class="modal" id="wheelOptionDialog">
        <div class="modal-header">
            <h3 id="wheelOptionDialogTitle">新增轉盤選項</h3>
            <button class="modal-close" onclick="closeDialog('wheelOptionDialog')">×</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="wheelOptionEditIndex" value="-1">
            <div class="form-group">
                <label>選項名稱</label>
                <input type="text" id="optionName" class="input" placeholder="例如: 選項A">
            </div>
            <div class="form-group">
                <label>顏色</label>
                <input type="color" id="optionColor" class="input-color" value="#4ecca3">
            </div>
            <div class="form-group">
                <label>權重</label>
                <input type="number" id="optionWeight" class="input input-sm" value="1" min="1">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeDialog('wheelOptionDialog')">取消</button>
            <button class="btn btn-primary" onclick="saveWheelOption()">儲存</button>
        </div>
    </div>

    <!-- 影片觸發對話框 -->
    <div class="modal" id="videoGiftDialog">
        <div class="modal-header">
            <h3 id="videoGiftDialogTitle">新增影片觸發</h3>
            <button class="modal-close" onclick="closeDialog('videoGiftDialog')">×</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="videoGiftEditIndex" value="-1">
            <div class="form-group">
                <label>顯示名稱</label>
                <input type="text" id="videoGiftDisplayName" class="input" placeholder="方便辨識的名稱，例如: 玫瑰特效">
            </div>
            <div class="form-group">
                <label>觸發方式</label>
                <select id="videoTriggerType" class="input" onchange="toggleVideoTriggerOptions()">
                    <option value="gift">禮物</option>
                    <option value="chat">彈幕關鍵字</option>
                    <option value="like">點讚</option>
                    <option value="shortcut">快捷鍵</option>
                </select>
            </div>
            <div class="form-group" id="videoGiftNameGroup">
                <label>禮物名稱</label>
                <input type="text" id="videoGiftName" class="input" placeholder="TikTok 禮物名稱，例如: Rose">
            </div>
            <div class="form-group" id="videoKeywordGroup" style="display:none">
                <label>彈幕關鍵字</label>
                <input type="text" id="videoTriggerKeyword" class="input" placeholder="觸發的關鍵字">
            </div>
            <div class="form-group" id="videoShortcutGroup" style="display:none">
                <label>快捷鍵</label>
                <div class="input-with-button">
                    <input type="text" id="videoShortcut" class="input" placeholder="點擊後按下快捷鍵" readonly>
                    <button class="btn btn-sm" onclick="clearVideoShortcut()">清除</button>
                </div>
                <small class="form-hint">支援 F1-F12、Ctrl/Alt/Shift 組合鍵</small>
            </div>
            <div class="form-group">
                <label>影片路徑</label>
                <div class="input-with-button">
                    <input type="text" id="videoPath" class="input" placeholder="選擇影片檔案">
                    <button class="btn btn-sm" onclick="selectVideoFile()">瀏覽</button>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>優先級 (1-10)</label>
                    <input type="number" id="videoPriority" class="input input-sm" value="1" min="1" max="10">
                </div>
                <div class="form-group">
                    <label>重複次數</label>
                    <input type="number" id="videoRepeat" class="input input-sm" value="1" min="1">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>播放秒數 (0=完整)</label>
                    <input type="number" id="videoSeconds" class="input input-sm" value="0" min="0" step="0.5">
                </div>
                <div class="form-group">
                    <label>播放倍率</label>
                    <input type="number" id="videoSpeed" class="input input-sm" value="1.0" min="0.1" max="4" step="0.1">
                </div>
            </div>
            <div class="form-group">
                <label>音量</label>
                <div class="range-input">
                    <input type="range" id="videoVolume" value="100" min="0" max="100">
                    <span id="volumeValue" class="range-value">100%</span>
                </div>
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="forceInterrupt">
                    <span class="checkbox-box"></span>
                    強制插隊 (中斷當前播放)
                </label>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeDialog('videoGiftDialog')">取消</button>
            <button class="btn btn-primary" onclick="saveVideoGift()">儲存</button>
        </div>
    </div>

    <!-- 隨機影片對話框 -->
    <div class="modal" id="randomVideoDialog">
        <div class="modal-header">
            <h3 id="randomVideoDialogTitle">新增隨機影片</h3>
            <button class="modal-close" onclick="closeDialog('randomVideoDialog')">×</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="randomVideoEditIndex" value="-1">
            <div class="form-group">
                <label>名稱</label>
                <input type="text" id="randomVideoName" class="input" placeholder="例如: 禮物特效">
            </div>
            <div class="form-group">
                <label>觸發方式</label>
                <select id="randomVideoTriggerType" class="input" onchange="toggleRandomVideoTriggerOptions()">
                    <option value="gift">禮物</option>
                    <option value="chat">彈幕關鍵字</option>
                    <option value="like">點讚</option>
                </select>
            </div>
            <div class="form-group" id="randomVideoGiftGroup">
                <label>觸發禮物名稱</label>
                <input type="text" id="randomVideoTriggerGift" class="input" placeholder="例如: Rose">
            </div>
            <div class="form-group" id="randomVideoKeywordGroup" style="display:none">
                <label>彈幕關鍵字</label>
                <input type="text" id="randomVideoTriggerKeyword" class="input" placeholder="觸發的關鍵字">
            </div>
            <div class="form-group">
                <label>影片資料夾</label>
                <div class="input-with-button">
                    <input type="text" id="randomVideoFolderPath" class="input" placeholder="選擇包含影片的資料夾">
                    <button class="btn btn-sm" onclick="selectRandomVideoFolder()">瀏覽</button>
                </div>
                <small id="randomVideoFolderInfo"></small>
            </div>
            <div class="form-group" id="randomVideoWeightsGroup" style="display: none;">
                <label>影片機率設定 <small style="opacity: 0.6;">(權重越高機率越大)</small></label>
                <div id="randomVideoWeightsList" class="weights-list"></div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>優先級 (1-10)</label>
                    <input type="number" id="randomVideoPriority" class="input input-sm" value="1" min="1" max="10">
                </div>
                <div class="form-group">
                    <label>重複次數</label>
                    <input type="number" id="randomVideoRepeat" class="input input-sm" value="1" min="1">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>播放秒數 (0=完整)</label>
                    <input type="number" id="randomVideoSeconds" class="input input-sm" value="0" min="0" step="0.5">
                </div>
                <div class="form-group">
                    <label>播放倍率</label>
                    <input type="number" id="randomVideoSpeed" class="input input-sm" value="1.0" min="0.1" max="4" step="0.1">
                </div>
            </div>
            <div class="form-group">
                <label>音量</label>
                <div class="range-input">
                    <input type="range" id="randomVideoVolume" value="100" min="0" max="100" oninput="document.getElementById('randomVideoVolumeValue').textContent = this.value + '%'">
                    <span id="randomVideoVolumeValue" class="range-value">100%</span>
                </div>
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="randomVideoAvoidRepeat" checked>
                    <span class="checkbox-box"></span>
                    避免連續播放相同影片
                </label>
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="randomVideoForceInterrupt">
                    <span class="checkbox-box"></span>
                    強制插隊 (中斷當前播放)
                </label>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeDialog('randomVideoDialog')">取消</button>
            <button class="btn btn-primary" onclick="saveRandomVideo()">儲存</button>
        </div>
    </div>

    <!-- 抓鴨子數量對話框 -->
    <div class="modal" id="duckAmountDialog">
        <div class="modal-header">
            <h3>🦆 抓到鴨子了！</h3>
            <button class="modal-close" onclick="cancelDuckCatch()">×</button>
        </div>
        <div class="modal-body" style="text-align: center;">
            <input type="hidden" id="duckCatchUsername" value="">
            <input type="hidden" id="duckCatchVideoPath" value="">
            <p style="margin-bottom: 20px;">
                <span id="duckCatchUser" style="color: #10b981; font-weight: bold;"></span> 抓到鴨子了！
            </p>
            <div class="form-group">
                <label>抓到幾隻？</label>
                <input type="number" id="duckAmountInput" class="input" value="1" min="1" max="999" style="text-align: center; font-size: 32px; padding: 16px;">
            </div>
            <div class="quick-btns">
                <button class="btn btn-sm" onclick="setDuckAmount(1)">1</button>
                <button class="btn btn-sm" onclick="setDuckAmount(2)">2</button>
                <button class="btn btn-sm" onclick="setDuckAmount(3)">3</button>
                <button class="btn btn-sm" onclick="setDuckAmount(5)">5</button>
                <button class="btn btn-sm" onclick="setDuckAmount(10)">10</button>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="cancelDuckCatch()">取消</button>
            <button class="btn btn-primary" onclick="confirmDuckCatch()">確認</button>
        </div>
    </div>

    <!-- 補鴨子對話框 -->
    <div class="modal" id="addDuckDialog">
        <div class="modal-header">
            <h3>🦆 補鴨子</h3>
            <button class="modal-close" onclick="closeDialog('addDuckDialog')">×</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>用戶 ID (uniqueId)</label>
                <input type="text" id="addDuckUniqueId" class="input" placeholder="輸入用戶的 uniqueId（選填）">
                <small style="color: var(--text-muted);">留空則只增加總數，不計入排行榜</small>
            </div>
            <div class="form-group">
                <label>鴨子數量</label>
                <input type="number" id="addDuckAmount" class="input" value="1" min="1" max="9999" style="text-align: center; font-size: 24px;">
            </div>
            <div class="quick-btns">
                <button class="btn btn-sm" onclick="setAddDuckAmount(1)">1</button>
                <button class="btn btn-sm" onclick="setAddDuckAmount(5)">5</button>
                <button class="btn btn-sm" onclick="setAddDuckAmount(10)">10</button>
                <button class="btn btn-sm" onclick="setAddDuckAmount(50)">50</button>
                <button class="btn btn-sm" onclick="setAddDuckAmount(100)">100</button>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeDialog('addDuckDialog')">取消</button>
            <button class="btn btn-primary" onclick="confirmAddDuck()">確認補鴨子</button>
        </div>
    </div>

    <!-- 場景名稱對話框 -->
    <div class="modal" id="sceneNameDialog" style="max-width: 400px;">
        <div class="modal-header">
            <h3 id="sceneNameDialogTitle">新增場景</h3>
            <button class="modal-close" onclick="closeDialog('sceneNameDialog')">×</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="sceneNameEditId" value="">
            <div class="form-group">
                <label>場景名稱</label>
                <input type="text" id="sceneNameInput" class="input" placeholder="輸入場景名稱">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeDialog('sceneNameDialog')">取消</button>
            <button class="btn btn-primary" onclick="confirmSceneName()">確認</button>
        </div>
    </div>

    <!-- 模擬抓鴨子對話框 -->
    <div class="modal" id="simulateDuckDialog">
        <div class="modal-header">
            <h3>🎲 模擬抓鴨子</h3>
            <button class="modal-close" onclick="closeDialog('simulateDuckDialog')">×</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>用戶 ID (uniqueId)</label>
                <input type="text" id="simulateDuckUniqueId" class="input" placeholder="輸入用戶的 uniqueId">
                <small style="color: var(--text-muted);">會以此用戶名義觸發抓鴨子並更新排行榜</small>
            </div>
            <div class="form-group">
                <label>觸發次數</label>
                <input type="number" id="simulateDuckTimes" class="input" value="1" min="1" max="99" style="text-align: center; font-size: 24px;">
            </div>
            <div class="quick-btns">
                <button class="btn btn-sm" onclick="setSimulateDuckTimes(1)">1次</button>
                <button class="btn btn-sm" onclick="setSimulateDuckTimes(2)">2次</button>
                <button class="btn btn-sm" onclick="setSimulateDuckTimes(3)">3次</button>
                <button class="btn btn-sm" onclick="setSimulateDuckTimes(5)">5次</button>
                <button class="btn btn-sm" onclick="setSimulateDuckTimes(10)">10次</button>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeDialog('simulateDuckDialog')">取消</button>
            <button class="btn btn-primary" onclick="confirmSimulateDuck()">開始模擬</button>
        </div>
    </div>

    <!-- 鴨子影片對話框 -->
    <div class="modal" id="duckVideoDialog">
        <div class="modal-header">
            <h3 id="duckVideoDialogTitle">新增鴨子影片</h3>
            <button class="modal-close" onclick="closeDialog('duckVideoDialog')">×</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="duckVideoType" value="caught">
            <input type="hidden" id="duckVideoEditIndex" value="-1">
            <div class="form-group">
                <label>影片檔案</label>
                <div class="input-with-button">
                    <input type="text" id="duckVideoPath" class="input" placeholder="選擇影片檔案" readonly>
                    <button class="btn btn-sm" onclick="selectDuckVideo()">瀏覽</button>
                </div>
            </div>
            <div class="form-group">
                <label>權重</label>
                <input type="number" id="duckVideoWeight" class="input" value="1" min="1" max="100">
            </div>
            <div class="form-group" id="duckVideoAmountGroup">
                <label>增加鴨子數量</label>
                <input type="number" id="duckVideoAmount" class="input" value="1" min="1" max="999">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeDialog('duckVideoDialog')">取消</button>
            <button class="btn btn-primary" onclick="saveDuckVideo()">確定</button>
        </div>
    </div>

    <!-- 進場用戶對話框 -->
    <div class="modal" id="entryEditDialog">
        <div class="modal-header">
            <h3 id="entryEditDialogTitle">新增進場用戶</h3>
            <button class="modal-close" onclick="closeDialog('entryEditDialog')">×</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="entryEditIndex" value="-1">
            <div class="form-group">
                <label>用戶名稱或 ID</label>
                <input type="text" id="entryUsername" class="input" placeholder="例如：老公 或 yyue97342bf">
            </div>
            <div class="form-group">
                <label>媒體檔案</label>
                <div class="input-with-button">
                    <input type="text" id="entryMediaPath" class="input" readonly placeholder="選擇影片或音效...">
                    <button class="btn btn-sm" onclick="selectEntryMedia()">瀏覽</button>
                </div>
                <small id="entryMediaTypeHint">支援 MP4/AVI/MOV 或 MP3/WAV/OGG</small>
            </div>
            <div class="form-group">
                <label>音量</label>
                <div class="range-input">
                    <input type="range" id="entryVolume" min="0" max="100" value="100">
                    <span id="entryVolumeLabel" class="range-value">100%</span>
                </div>
            </div>
            <div class="form-group">
                <label>冷卻時間（秒）</label>
                <input type="number" id="entryCooldown" class="input input-sm" value="300" min="0">
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="entryForceInterrupt" checked>
                    <span class="checkbox-box"></span>
                    強制中斷其他播放
                </label>
            </div>
            <div class="form-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="entryShowText" onchange="toggleEntryTextSettings()">
                    <span class="checkbox-box"></span>
                    顯示進場文字
                </label>
            </div>
            <div id="entryTextSettings" style="display: none;">
                <div class="form-group">
                    <label>進場文字</label>
                    <input type="text" id="entryText" class="input" placeholder="歡迎 {name} 進入直播間！">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>文字大小</label>
                        <input type="number" id="entryTextSize" class="input input-sm" value="48" min="12" max="200">
                    </div>
                    <div class="form-group">
                        <label>文字顏色</label>
                        <input type="color" id="entryTextColor" class="input-color" value="#ffffff">
                    </div>
                    <div class="form-group">
                        <label>顯示時間</label>
                        <input type="number" id="entryTextDuration" class="input input-sm" value="5" min="1" max="30">
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeDialog('entryEditDialog')">取消</button>
            <button class="btn btn-primary" onclick="saveEntry()">儲存</button>
        </div>
    </div>

    <!-- 盲盒禮物對話框 -->
    <div class="modal" id="giftboxGiftDialog">
        <div class="modal-header">
            <h3 id="giftboxGiftDialogTitle">新增盲盒觸發</h3>
            <button class="modal-close" onclick="closeDialog('giftboxGiftDialog')">×</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="giftboxGiftEditIndex" value="-1">
            <div class="form-group">
                <label>禮物名稱</label>
                <input type="text" id="giftboxGiftName" class="input" placeholder="例如: Rose">
            </div>
            <div class="form-group">
                <label>開盒次數 (每個禮物)</label>
                <input type="number" id="giftboxGiftCount" class="input input-sm" value="1" min="1">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeDialog('giftboxGiftDialog')">取消</button>
            <button class="btn btn-primary" onclick="saveGiftboxGift()">儲存</button>
        </div>
    </div>

    <!-- 盲盒選項對話框 -->
    <div class="modal" id="giftboxOptionDialog">
        <div class="modal-header">
            <h3 id="giftboxOptionDialogTitle">新增盲盒選項</h3>
            <button class="modal-close" onclick="closeDialog('giftboxOptionDialog')">×</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="giftboxOptionEditIndex" value="-1">
            <div class="form-group">
                <label>選項名稱</label>
                <input type="text" id="giftboxOptionName" class="input" placeholder="例如: 大獎">
            </div>
            <div class="form-group">
                <label>顏色</label>
                <input type="color" id="giftboxOptionColor" class="input-color" value="#ffd93d">
            </div>
            <div class="form-group">
                <label>權重</label>
                <input type="number" id="giftboxOptionWeight" class="input input-sm" value="1" min="1">
            </div>
            <div class="form-group">
                <label>影片路徑 (可選)</label>
                <div class="input-with-button">
                    <input type="text" id="giftboxOptionVideoPath" class="input" placeholder="選擇影片檔案">
                    <button class="btn btn-sm" onclick="selectGiftboxVideoFile()">瀏覽</button>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>播放秒數 (0=完整)</label>
                    <input type="number" id="giftboxOptionVideoSeconds" class="input input-sm" value="0" min="0" step="0.5">
                </div>
                <div class="form-group">
                    <label>音量</label>
                    <div class="range-input">
                        <input type="range" id="giftboxOptionVideoVolume" value="100" min="0" max="100">
                        <span id="giftboxVolumeValue" class="range-value">100%</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeDialog('giftboxOptionDialog')">取消</button>
            <button class="btn btn-primary" onclick="saveGiftboxOption()">儲存</button>
        </div>
    </div>

    <!-- 模擬送禮對話框 -->
    <div class="modal" id="simulateDialog">
        <div class="modal-header">
            <h3>🎁 模擬送禮</h3>
            <button class="modal-close" onclick="closeDialog('simulateDialog')">×</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>用戶名稱</label>
                <input type="text" id="simUsername" class="input" value="測試用戶">
            </div>
            <div class="form-group">
                <label>禮物</label>
                <select id="simGift" class="input"></select>
            </div>
            <div class="form-group">
                <label>數量</label>
                <input type="number" id="simCount" class="input input-sm" value="1" min="1">
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn" onclick="closeDialog('simulateDialog')">取消</button>
            <button class="btn btn-primary" onclick="doSimulate()">送出</button>
        </div>
    </div>

    <!-- 總體資料庫用戶編輯對話框 -->
    <div class="modal" id="userDuckDialog">
        <div class="modal-header">
            <h3 id="userDuckDialogTitle">新增用戶</h3>
            <button class="modal-close" onclick="closeDialog('userDuckDialog')">×</button>
        </div>
        <div class="modal-body">
            <input type="hidden" id="userDuckEditMode" value="add">
            <div class="form-group">
                <label>用戶 ID (uniqueId)</label>
                <input type="text" id="userDuckUniqueId" class="input" placeholder="輸入用戶的 uniqueId">
            </div>
            <div class="form-group">
                <label>暱稱</label>
                <input type="text" id="userDuckNickname" class="input" placeholder="輸入用戶暱稱">
            </div>
            <div class="form-group">
                <label>鴨子數量</label>
                <input type="number" id="userDuckAmount" class="input" value="0" min="0">
            </div>
            <div class="quick-btns" id="userDuckAdjustBtns" style="display:none">
                <button class="btn btn-sm btn-danger" onclick="adjustUserDuckAmount(-100)">-100</button>
                <button class="btn btn-sm btn-danger" onclick="adjustUserDuckAmount(-10)">-10</button>
                <button class="btn btn-sm btn-danger" onclick="adjustUserDuckAmount(-1)">-1</button>
                <button class="btn btn-sm btn-primary" onclick="adjustUserDuckAmount(1)">+1</button>
                <button class="btn btn-sm btn-primary" onclick="adjustUserDuckAmount(10)">+10</button>
                <button class="btn btn-sm btn-primary" onclick="adjustUserDuckAmount(100)">+100</button>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-danger" id="userDuckDeleteBtn" style="display:none; margin-right:auto" onclick="deleteUserFromAlltime()">🗑️ 刪除</button>
            <button class="btn" onclick="closeDialog('userDuckDialog')">取消</button>
            <button class="btn btn-primary" onclick="saveUserDuck()">儲存</button>
        </div>
    </div>

    <script src="js/app.js"></script>
</body>
</html>
